import{as as X,d as re,r as _,f as ne,x as ie,o as v,c as h,a as e,H as d,J as b,h as i,j as de,A as a,y as V,T as Y,F as $,z as k,w as p,i as c,N as ue,p as ce,Z as H,L as O,$ as P}from"./index-dI1uNq6t.js";import{_ as Q}from"./icon-pencil.vue_vue_type_script_setup_true_lang-BCy_1Xjh.js";import{I as pe}from"./icon-trash-BTjVOIXv.js";import{a as Z,A as K}from"./api-DrJ4TS1v.js";import{Y as M,h as U,_ as T,G as z,S as R}from"./transition-DCeE8c3q.js";import"./hidden-Vg9ffc-n.js";import"./keyboard-Nk6B-5nl.js";import"./open-closed-tpBJ7G3u.js";const me=X(),q=Z.create({baseURL:K});q.interceptors.request.use(u=>{const m=me.getToken;return m&&(u.headers.Authorization=`Bearer ${m}`),u},u=>Promise.reject(u));const ve=async u=>{try{return(await q.post("/users/register",u)).data}catch(m){throw console.error("Error creating user:",m),m}},he=async()=>{try{return(await q.get("/users/get-all-users")).data}catch(u){throw console.error("Error fetching users:",u),u}},be=async(u,m)=>{try{return(await q.put(`/users/update-user/${u}`,m)).data}catch(x){throw console.error("Error updating user:",x),x}},fe=X(),W=Z.create({baseURL:K});W.interceptors.request.use(u=>{const m=fe.getToken;return m&&(u.headers.Authorization=`Bearer ${m}`),u},u=>Promise.reject(u));const _e=()=>W.get("/roles"),ye={class:"panel"},we={class:"flex items-center justify-between mb-4"},ge={class:"flex items-center"},$e={class:"relative w-64 ltr:mr-4 rtl:ml-4"},ke=["placeholder"],Ue={class:"absolute right-[11px] top-1/2 -translate-y-1/2"},xe={class:"mb-4"},Ce={class:"flex border-b border-white-light dark:border-[#191e3a]"},Ne={class:"datatable"},Ae={class:"table-responsive"},Ve={class:"table-hover"},Pe={class:"!text-center"},qe={class:"flex flex-wrap gap-2"},Le={class:"text-center"},je={class:"flex items-center justify-center gap-4"},Ie=["onClick"],Se={class:"datatable"},Ee={class:"table-responsive"},De={class:"table-hover"},Me={class:"!text-center"},Te={class:"flex flex-wrap gap-2"},ze={class:"text-center"},Re={class:"flex items-center justify-center gap-4"},Be=["onClick"],Fe={class:"fixed inset-0 overflow-y-auto"},Ge={class:"flex min-h-full items-start justify-center px-4 py-8"},Je={class:"text-lg font-bold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]"},Ye={class:"p-5"},He={class:"mb-5"},Oe={for:"name"},Qe=["placeholder"],Xe={class:"mb-5"},Ze={for:"username"},Ke=["placeholder"],We={class:"mb-5"},et={for:"email"},tt=["placeholder"],st={class:"mb-5"},at={for:"phonenumber"},ot=["placeholder"],lt={class:"mb-5"},rt={for:"role"},nt=["value"],it={class:"text-gray-500 dark:text-gray-400"},dt={class:"mb-5"},ut={for:"status"},ct={value:""},pt={value:"active"},mt={value:"inactive"},vt={class:"mb-5"},ht={for:"password"},bt=["placeholder"],ft={class:"mb-5"},_t={for:"confirm-password"},yt=["placeholder"],wt={class:"flex justify-end gap-4"},gt={type:"submit",class:"btn btn-primary"},$t={class:"fixed inset-0 overflow-y-auto"},kt={class:"flex min-h-full items-start justify-center px-4 py-8"},Ut={class:"text-lg font-bold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]"},xt={class:"p-5"},Ct={class:"mb-5"},Nt={for:"edit-name"},At=["placeholder"],Vt={class:"mb-5"},Pt={for:"edit-username"},qt=["placeholder"],Lt={class:"mb-5"},jt={for:"edit-email"},It=["placeholder"],St={class:"mb-5"},Et={for:"phonenumber"},Dt=["placeholder"],Mt={class:"mb-5"},Tt={for:"edit-role"},zt=["value"],Rt={class:"text-gray-500 dark:text-gray-400"},Bt={class:"mb-5"},Ft={for:"edit-status"},Gt={value:""},Jt={value:"active"},Yt={value:"inactive"},Ht={class:"mb-5"},Ot={for:"edit-password"},Qt=["placeholder"],Xt={class:"text-gray-500 dark:text-gray-400"},Zt={class:"mb-5"},Kt={for:"edit-confirm-password"},Wt=["placeholder"],es={class:"text-gray-500 dark:text-gray-400"},ts={class:"flex justify-end gap-4"},ss={type:"submit",class:"btn btn-primary"},as={class:"fixed inset-0 overflow-y-auto"},os={class:"flex min-h-full items-start justify-center px-4 py-8"},ls={class:"p-5"},rs={class:"text-center"},ns={class:"w-16 h-16 rounded-full bg-danger/20 flex items-center justify-center mx-auto mb-5"},is={class:"text-lg font-bold mb-3"},ds={class:"text-gray-500 dark:text-gray-400 mb-5"},us={class:"flex justify-center gap-4"},ys=re({__name:"UserList",setup(u){const m=async()=>{try{const t=await _e(),o=Array.isArray(t)?t:t.data||[];if(!Array.isArray(o)){console.error("Error: Roles data is not an array.");return}I.value=o.map(s=>({id:s.id,name:s.name}))}catch(t){console.error("Error fetching roles:",t)}},x=async()=>{try{const t=await he(),o=Array.isArray(t)?t:t.data||[];if(!Array.isArray(o)){console.error("Error: Users data is not an array.");return}const s=o.map(r=>({id:r.id,name:r.name,username:r.username,email:r.email,roles:r.roles||[],phoneNumber:r.phone_number,lastLogin:r.updated_at,status:r.active===1?"active":"inactive"}));f.value=s.filter(r=>r.status==="active"),w.value=s.filter(r=>r.status==="inactive")}catch(t){console.error("Error fetching users:",t)}},y=_("active"),L=_(!1),j=_(!1),I=_([]),f=_([]),w=_([]),C=_(null),S=_(""),B=ne(()=>{const t=S.value.toLowerCase();return(y.value==="active"?f.value:w.value).filter(o=>o.name.toLowerCase().includes(t)||o.username.toLowerCase().includes(t)||o.email.toLowerCase().includes(t)||o.phoneNumber.toLowerCase().includes(t)||o.roles.some(s=>s.name.toLowerCase().includes(t)))}),ee=()=>{L.value=!0},N=()=>{L.value=!1,te()},te=()=>{n.value={name:"",username:"",email:"",phoneNumber:"",roles:[],status:"",password:"",confirmPassword:""}},n=_({name:"",username:"",email:"",phoneNumber:"",roles:[],status:"",password:"",confirmPassword:""}),se=async()=>{if(n.value.password!==n.value.confirmPassword){alert("Passwords do not match!");return}const t={name:n.value.name,username:n.value.username,email:n.value.email,phone_number:n.value.phoneNumber||"",password:n.value.password,active:n.value.status==="active"?1:0,roles:n.value.roles};try{const o=await ve(t);console.log("User created successfully:",o);const s={id:Math.max(...[...f.value,...w.value].map(r=>r.id))+1,name:n.value.name,username:n.value.username,email:n.value.email,phoneNumber:n.value.phoneNumber,roles:t.roles.map((r,g)=>({id:g+1,name:r})),lastLogin:new Date().toLocaleString(),status:n.value.status};n.value.status==="active"?f.value.push(s):w.value.push(s),N()}catch{alert("Failed to create user. Please try again.")}},E=_(!1),l=_({id:0,name:"",username:"",email:"",phoneNumber:"",roles:[],status:"",password:"",confirmPassword:""}),F=t=>{l.value={id:t.id,name:t.name,username:t.username,email:t.email,phoneNumber:t.phoneNumber,roles:t.roles.map(o=>o.name),status:t.status,password:"",confirmPassword:""},E.value=!0},ae=async()=>{if(l.value.password&&l.value.password!==l.value.confirmPassword){alert("Passwords do not match!");return}const t={name:l.value.name,username:l.value.username,email:l.value.email,phone_number:l.value.phoneNumber||"",active:l.value.status==="active"?1:0,roles:l.value.roles};l.value.password&&l.value.password.trim()!==""&&(t.password=l.value.password);try{const o=await be(l.value.id,t);console.log("User updated successfully:",o);const s=f.value.findIndex(r=>r.id===l.value.id);if(s!==-1)f.value[s]={...f.value[s],...t,roles:t.roles.map(r=>({name:r})),status:l.value.status};else{const r=w.value.findIndex(g=>g.id===l.value.id);r!==-1&&(w.value[r]={...w.value[r],...t,roles:t.roles.map(g=>({name:g})),status:l.value.status})}if(l.value.status!==y.value){const r=y.value==="active"?f:w,g=y.value==="active"?w:f,J=r.value.findIndex(D=>D.id===l.value.id);if(J!==-1){const[D]=r.value.splice(J,1);g.value.push(D)}}A()}catch(o){console.error("Error updating user:",o);const s=o;s.response&&s.response.data&&s.response.data.error?alert(`Failed to update user: ${JSON.stringify(s.response.data.error)}`):alert("Failed to update user. Please try again.")}},A=()=>{E.value=!1,l.value={id:0,name:"",username:"",email:"",phoneNumber:"",roles:[],status:"",password:"",confirmPassword:""}},G=()=>{j.value=!1,C.value=null},oe=()=>{C.value&&(le(C.value),j.value=!1,C.value=null)},le=t=>{const o=f.value.findIndex(s=>s.id===t.id);if(o!==-1){const[s]=f.value.splice(o,1);w.value.push(s)}};return ie(()=>{x(),m()}),(t,o)=>(v(),h("div",null,[e("div",ye,[e("div",we,[e("div",ge,[e("div",$e,[d(e("input",{type:"text",class:"form-input peer",placeholder:t.$t("search_users"),"onUpdate:modelValue":o[0]||(o[0]=s=>S.value=s)},null,8,ke),[[b,S.value]]),e("div",Ue,[i(ue,{class:"w-4.5 h-4.5"})])])]),e("button",{type:"button",class:"btn btn-primary",onClick:ee},[i(ce,{class:"w-5 h-5 ltr:mr-2 rtl:ml-2"}),de(" "+a(t.$t("add_user")),1)])]),e("div",xe,[e("ul",Ce,[e("li",null,[e("a",{href:"javascript:;",class:V(["p-3.5 -mb-[1px] block border border-transparent hover:text-primary",{"text-primary border-b border-primary !border-white-light dark:!border-[#191e3a] dark:!border-b-primary":y.value==="active"}]),onClick:o[1]||(o[1]=s=>y.value="active")},a(t.$t("active_users")),3)]),e("li",null,[e("a",{href:"javascript:;",class:V(["p-3.5 -mb-[1px] block border border-transparent hover:text-primary",{"text-primary border-b border-primary !border-white-light dark:!border-[#191e3a] dark:!border-b-primary":y.value==="inactive"}]),onClick:o[2]||(o[2]=s=>y.value="inactive")},a(t.$t("inactive_users")),3)])])]),d(e("div",Ne,[e("div",Ae,[e("table",Ve,[e("thead",null,[e("tr",null,[e("th",null,a(t.$t("name")),1),e("th",null,a(t.$t("username")),1),e("th",null,a(t.$t("email")),1),e("th",null,a(t.$t("phonenumber")),1),e("th",null,a(t.$t("role")),1),e("th",null,a(t.$t("status")),1),e("th",Pe,a(t.$t("options")),1)])]),e("tbody",null,[(v(!0),h($,null,k(B.value,s=>(v(),h("tr",{key:s.id},[e("td",null,a(s.name),1),e("td",null,a(s.username),1),e("td",null,a(s.email),1),e("td",null,a(s.phoneNumber),1),e("td",null,[e("div",qe,[(v(!0),h($,null,k(s.roles,r=>(v(),h("span",{key:r.id,class:"badge badge-outline-primary"},a(r.name),1))),128))])]),e("td",null,[e("span",{class:V(["badge",s.status==="active"?"badge-outline-success":"badge-outline-danger"])},a(s.status),3)]),e("td",Le,[e("div",je,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:r=>F(s)},[i(Q,{class:"w-4.5 h-4.5"})],8,Ie)])])]))),128))])])])],512),[[Y,y.value==="active"]]),d(e("div",Se,[e("div",Ee,[e("table",De,[e("thead",null,[e("tr",null,[e("th",null,a(t.$t("name")),1),e("th",null,a(t.$t("username")),1),e("th",null,a(t.$t("email")),1),e("th",null,a(t.$t("phonenumber")),1),e("th",null,a(t.$t("role")),1),e("th",null,a(t.$t("status")),1),e("th",Me,a(t.$t("options")),1)])]),e("tbody",null,[(v(!0),h($,null,k(B.value,s=>(v(),h("tr",{key:s.id},[e("td",null,a(s.name),1),e("td",null,a(s.username),1),e("td",null,a(s.email),1),e("td",null,a(s.phoneNumber),1),e("td",null,[e("div",Te,[(v(!0),h($,null,k(s.roles,r=>(v(),h("span",{key:r.id,class:"badge badge-outline-primary"},a(r.name),1))),128))])]),e("td",null,[e("span",{class:V(["badge",s.status==="active"?"badge-outline-success":"badge-outline-danger"])},a(s.status),3)]),e("td",ze,[e("div",Re,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:r=>F(s)},[i(Q,{class:"w-4.5 h-4.5"})],8,Be)])])]))),128))])])])],512),[[Y,y.value==="inactive"]]),i(c(R),{appear:"",show:L.value,as:"template"},{default:p(()=>[i(c(M),{as:"div",onClose:N,class:"relative z-[51]"},{default:p(()=>[i(c(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[i(c(T),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",Fe,[e("div",Ge,[i(c(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[i(c(z),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark"},{default:p(()=>[e("button",{type:"button",class:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:N},[i(H)]),e("div",Je,a(t.$t("add_user")),1),e("div",Ye,[e("form",{onSubmit:O(se,["prevent"])},[e("div",He,[e("label",Oe,a(t.$t("name")),1),d(e("input",{id:"name",type:"text","onUpdate:modelValue":o[3]||(o[3]=s=>n.value.name=s),class:"form-input",placeholder:t.$t("enter_name"),required:""},null,8,Qe),[[b,n.value.name]])]),e("div",Xe,[e("label",Ze,a(t.$t("username")),1),d(e("input",{id:"username",type:"text","onUpdate:modelValue":o[4]||(o[4]=s=>n.value.username=s),class:"form-input",placeholder:t.$t("enter_username"),required:""},null,8,Ke),[[b,n.value.username]])]),e("div",We,[e("label",et,a(t.$t("email")),1),d(e("input",{id:"email",type:"email","onUpdate:modelValue":o[5]||(o[5]=s=>n.value.email=s),class:"form-input",placeholder:t.$t("enter_email"),required:""},null,8,tt),[[b,n.value.email]])]),e("div",st,[e("label",at,a(t.$t("phonenumber")),1),d(e("input",{id:"phonenumber",type:"phonenumber","onUpdate:modelValue":o[6]||(o[6]=s=>n.value.phoneNumber=s),class:"form-input",placeholder:t.$t("enter_phonenumber"),required:""},null,8,ot),[[b,n.value.phoneNumber]])]),e("div",lt,[e("label",rt,a(t.$t("role")),1),d(e("select",{id:"role","onUpdate:modelValue":o[7]||(o[7]=s=>n.value.roles=s),class:"form-select",multiple:"",required:""},[(v(!0),h($,null,k(I.value,s=>(v(),h("option",{key:s.id,value:s.name},a(s.name),9,nt))),128))],512),[[P,n.value.roles]]),e("small",it,a(t.$t("hold_ctrl_to_select_multiple")),1)]),e("div",dt,[e("label",ut,a(t.$t("status")),1),d(e("select",{id:"status","onUpdate:modelValue":o[8]||(o[8]=s=>n.value.status=s),class:"form-select",required:""},[e("option",ct,a(t.$t("select_status")),1),e("option",pt,a(t.$t("active")),1),e("option",mt,a(t.$t("inactive")),1)],512),[[P,n.value.status]])]),e("div",vt,[e("label",ht,a(t.$t("password")),1),d(e("input",{id:"password",type:"password","onUpdate:modelValue":o[9]||(o[9]=s=>n.value.password=s),class:"form-input",placeholder:t.$t("enter_password"),required:""},null,8,bt),[[b,n.value.password]])]),e("div",ft,[e("label",_t,a(t.$t("confirm_password")),1),d(e("input",{id:"confirm-password",type:"password","onUpdate:modelValue":o[10]||(o[10]=s=>n.value.confirmPassword=s),class:"form-input",placeholder:t.$t("confirm_password"),required:""},null,8,yt),[[b,n.value.confirmPassword]])]),e("div",wt,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:N},a(t.$t("cancel")),1),e("button",gt,a(t.$t("save")),1)])],32)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),i(c(R),{appear:"",show:E.value,as:"template"},{default:p(()=>[i(c(M),{as:"div",onClose:A,class:"relative z-[51]"},{default:p(()=>[i(c(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[i(c(T),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",$t,[e("div",kt,[i(c(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[i(c(z),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark"},{default:p(()=>[e("button",{type:"button",class:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:A},[i(H)]),e("div",Ut,a(t.$t("edit_user")),1),e("div",xt,[e("form",{onSubmit:O(ae,["prevent"])},[e("div",Ct,[e("label",Nt,a(t.$t("name")),1),d(e("input",{id:"edit-name",type:"text","onUpdate:modelValue":o[11]||(o[11]=s=>l.value.name=s),class:"form-input",placeholder:t.$t("enter_name"),required:""},null,8,At),[[b,l.value.name]])]),e("div",Vt,[e("label",Pt,a(t.$t("username")),1),d(e("input",{id:"edit-username",type:"text","onUpdate:modelValue":o[12]||(o[12]=s=>l.value.username=s),class:"form-input",placeholder:t.$t("enter_username"),required:""},null,8,qt),[[b,l.value.username]])]),e("div",Lt,[e("label",jt,a(t.$t("email")),1),d(e("input",{id:"edit-email",type:"email","onUpdate:modelValue":o[13]||(o[13]=s=>l.value.email=s),class:"form-input",placeholder:t.$t("enter_email"),required:""},null,8,It),[[b,l.value.email]])]),e("div",St,[e("label",Et,a(t.$t("phonenumber")),1),d(e("input",{id:"edit-phonenumber",type:"phonenumber","onUpdate:modelValue":o[14]||(o[14]=s=>l.value.phoneNumber=s),class:"form-input",placeholder:t.$t("enter_phonenumber"),required:""},null,8,Dt),[[b,l.value.phoneNumber]])]),e("div",Mt,[e("label",Tt,a(t.$t("role")),1),d(e("select",{id:"edit-role","onUpdate:modelValue":o[15]||(o[15]=s=>l.value.roles=s),class:"form-select",multiple:"",required:""},[(v(!0),h($,null,k(I.value,s=>(v(),h("option",{key:s.id,value:s.name},a(s.name),9,zt))),128))],512),[[P,l.value.roles]]),e("small",Rt,a(t.$t("hold_ctrl_to_select_multiple")),1)]),e("div",Bt,[e("label",Ft,a(t.$t("status")),1),d(e("select",{id:"edit-status","onUpdate:modelValue":o[16]||(o[16]=s=>l.value.status=s),class:"form-select",required:""},[e("option",Gt,a(t.$t("select_status")),1),e("option",Jt,a(t.$t("active")),1),e("option",Yt,a(t.$t("inactive")),1)],512),[[P,l.value.status]])]),e("div",Ht,[e("label",Ot,a(t.$t("password")),1),d(e("input",{id:"edit-password",type:"password","onUpdate:modelValue":o[17]||(o[17]=s=>l.value.password=s),class:"form-input",placeholder:t.$t("enter_password")},null,8,Qt),[[b,l.value.password]]),e("small",Xt,a(t.$t("password_leave_blank")),1)]),e("div",Zt,[e("label",Kt,a(t.$t("confirm_password")),1),d(e("input",{id:"edit-confirm-password",type:"password","onUpdate:modelValue":o[18]||(o[18]=s=>l.value.confirmPassword=s),class:"form-input",placeholder:t.$t("confirm_password")},null,8,Wt),[[b,l.value.confirmPassword]]),e("small",es,a(t.$t("password_leave_blank")),1)]),e("div",ts,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:A},a(t.$t("cancel")),1),e("button",ss,a(t.$t("update")),1)])],32)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),i(c(R),{appear:"",show:j.value,as:"template"},{default:p(()=>[i(c(M),{as:"div",onClose:G,class:"relative z-[51]"},{default:p(()=>[i(c(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[i(c(T),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",as,[e("div",os,[i(c(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[i(c(z),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark"},{default:p(()=>{var s;return[e("div",ls,[e("div",rs,[e("div",ns,[i(pe,{class:"w-8 h-8 text-danger"})]),e("h3",is,a(t.$t("deactivate_user")),1),e("p",ds,a(t.$t("deactivate_user_confirmation",{username:(s=C.value)==null?void 0:s.username})),1),e("div",us,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:G},a(t.$t("cancel")),1),e("button",{type:"button",class:"btn btn-danger",onClick:oe},a(t.$t("deactivate")),1)])])])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])]))}});export{ys as default};
